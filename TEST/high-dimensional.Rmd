---
title: "high-dimensional"
output: html_document
---

```{r setup, include=FALSE}
set.seed(1)
n <- 10000
p <- 1000

SS <- matrix(0.2, p - 1, p - 1)
diag(SS) <- 1

X <- cbind(1, matrix(rnorm(n * (p - 1)), n, p - 1) %*% chol(SS))
betas <- runif(p)
y <- rbinom(n, 1, prob = plogis(X %*% betas))
```


# Example 1 

```{r setup, include=FALSE}
set.seed(1)
n <- 500
p <- 100

SS <- matrix(0.2, p - 1, p - 1)
diag(SS) <- 1

X <- cbind(1, matrix(rnorm(n * (p - 1)), n, p - 1) %*% chol(SS))
betas <- runif(p)
y <- rbinom(n, 1, prob = plogis(X %*% betas))

library(brglm2)
m <- nrow(X)
y_dy <- p / (p + m) * 0.5 + m / (p + m) * y

# DY ESTIMATE
t0 <- Sys.time()
fit_dy <- glm(y_dy ~ X - 1, family = binomial("logit"))
t1 <- Sys.time()
elapsed_dy <- t1 - t0

library(RcppNumerical)
t0 <- Sys.time()
fit_fast_dy <- fastLR(X, y_dy)
t1 <- Sys.time()
elapsed_fast_dy <- t1 - t0

# FIRTH (1993)
t0 <- Sys.time()
fit_firth <- glm(y ~ -1 + X,
  family = binomial("logit"),
  method = "brglmFit", type = "AS_mean"
)
t1 <- Sys.time()
elapsed_firth <- t1 - t0

# KENNE PAGUI ET AL. (2017)
t0 <- Sys.time()
fit_kp <- glm(y ~ -1 + X,
  family = binomial("logit"),
  method = "brglmFit", type = "AS_median"
)
t1 <- Sys.time()
elapsed_kp <- t1 - t0


c(elapsed_dy, elapsed_fast_dy, elapsed_firth, elapsed_kp)
```

# Example 2

```{r}
set.seed(1)
n <- 5000
p <- 1000

SS <- matrix(0.2, p - 1, p - 1)
diag(SS) <- 1

X <- cbind(1, matrix(rnorm(n * (p - 1)), n, p - 1) %*% chol(SS))
betas <- runif(p)
y <- rbinom(n, 1, prob = plogis(X %*% betas))

library(brglm2)
m <- nrow(X)
y_dy <- p / (p + m) * 0.5 + m / (p + m) * y

# DY ESTIMATE
t0 <- Sys.time()
fit_dy <- glm(y_dy ~ X - 1, family = binomial("logit"))
t1 <- Sys.time()
elapsed_dy <- t1 - t0

library(RcppNumerical)
t0 <- Sys.time()
fit_fast_dy <- fastLR(X, y_dy)
t1 <- Sys.time()
elapsed_fast_dy <- t1 - t0

# FIRTH (1993)
t0 <- Sys.time()
fit_firth <- glm(y ~ -1 + X,
  family = binomial("logit"),
  method = "brglmFit", type = "AS_mean"
)
t1 <- Sys.time()
beta_firth <- coef(fit_firth)

# DO NOT EXECUTE

# # KENNE PAGUI ET AL. (2017)
# t0 <- Sys.time()
# fit_kp <- glm(y ~ -1 + X,
#   family = binomial("logit"),
#   method = "brglmFit", type = "AS_median"
# )
# t1 <- Sys.time()

c(elapsed_dy, elapsed_fast_dy, elapsed_firth)
```
